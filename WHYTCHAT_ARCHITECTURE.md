# WhytChat V1.0.0 - Architecture Overview

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              WhytChat Desktop Application                       │
│                              (Tauri v2 Framework)                               │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Application Window                                │
│                              (1200x800, Resizable)                             │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Main Layout                                       │
│  ┌─────────────┐  ┌─────────────────────┐  ┌─────────────────┐                │
│  │   Sidebar   │  │    Chat Interface   │  │   Right Panel    │                │
│  │  (Sessions) │  │  (Messages + Input) │  │ (Orchestration)  │                │
│  └─────────────┘  └─────────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Tauri IPC Bridge                                  │
│  Frontend (React/Vite) ◄────────────► Backend (Rust/Tokio)                     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Actor System                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                             │
│  │ Supervisor  │  │    RAG     │  │    LLM     │                             │
│  │  (Main)     │  │   Actor     │  │   Actor    │                             │
│  └─────────────┘  └─────────────┘  └─────────────┘                             │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Data Layer                                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                             │
│  │  SQLite DB  │  │  LanceDB    │  │ File System │                             │
│  │ (Sessions)  │  │ (Vectors)   │  │  (Files)    │                             │
│  └─────────────┘  └─────────────┘  └─────────────┘                             │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Actor Communication Flow

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   User Input    │────►│   Supervisor    │────►│   RAG Actor     │
│                 │     │   Actor         │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        ▲                       │                        │
        │                       ▼                        ▼
        │              ┌─────────────────┐     ┌─────────────────┐
        │              │   LLM Actor     │◄────│  Vector Search   │
        │              │                 │     │  (Embeddings)    │
        │              └─────────────────┘     └─────────────────┘
        │                       │                        ▲
        │                       ▼                        │
        │              ┌─────────────────┐                │
        └──────────────│ Streaming Tokens │────────────────┘
                       │ to Frontend      │
                       └─────────────────┘
```

## Data Flow Architecture

```
┌─────────────────┐
│   User Message  │
└─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Session Config  │────►│   Analysis      │
│   Retrieval     │     │   (LLM)         │
└─────────────────┘     └─────────────────┘
        │                        │
        ▼                        ▼
┌─────────────────┐     ┌─────────────────┐
│ Context Search  │────►│   RAG Query     │
│   (Session)     │     │   (Vector DB)   │
└─────────────────┘     └─────────────────┘
        │                        │
        ▼                        ▼
┌─────────────────┐     ┌─────────────────┐
│   Knowledge     │────►│   Response      │
│   Base Search   │     │   Generation    │
└─────────────────┘     └─────────────────┘
        │                        │
        ▼                        ▼
┌─────────────────┐     ┌─────────────────┐
│   Final Answer  │────►│   Database      │
│                 │     │   Persistence   │
└─────────────────┘     └─────────────────┘
```

## Frontend Component Hierarchy

```
┌─────────────────┐
│      App        │
│   (Root)        │
└─────────────────┘
        │
        ▼
┌─────────────────┐
│  MainLayout     │
└─────────────────┘
        │
        ▼
┌─────────────────────────────────────┐
│         Sidebar   │   ChatInterface  │   RightPanel     │
│                   │                  │                  │
│  ┌─────────────┐  │  ┌─────────────┐ │  ┌─────────────┐ │
│  │ New Chat    │  │  │ Messages    │ │  │ Thinking    │ │
│  │ Sessions    │  │  │ ChatInput   │ │  │ Steps       │ │
│  └─────────────┘  │  └─────────────┘ │  └─────────────┘ │
└─────────────────────────────────────┘
```

## Message Processing Pipeline

```
┌─────────────────┐
│ User Types      │
│ Message         │
└─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ ChatInput       │────►│   onSend()      │
│ Component       │     │   Handler       │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Frontend State  │────►│   Thinking      │
│ (Zustand)       │     │   UI Update     │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Tauri Invoke    │────►│ process_user_   │
│                 │     │ message Command │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Supervisor      │────►│ ProcessUser     │
│ Actor           │     │ Message         │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Thinking Steps  │────►│   UI Events     │
│ Emission        │     │   (WebSocket)   │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ RAG Search      │────►│ Context         │
│                 │     │ Retrieval       │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ LLM Generation  │────►│ Streaming       │
│                 │     │ Tokens          │
└─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│ Response        │────►│ Database        │
│ Completion      │     │ Persistence     │
└─────────────────┘     └─────────────────┘
```

## Database Schema

```
┌─────────────────────────────────────────────────────────┐
│                    SQLite Database                      │
│                  (whytchat.sqlite)                      │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                     sessions                            │
├─────────────────────────────────────────────────────────┤
│ id (TEXT, PK)                                           │
│ title (TEXT)                                            │
│ created_at (DATETIME)                                   │
│ model_config (JSON)                                     │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                     messages                            │
├─────────────────────────────────────────────────────────┤
│ id (INTEGER, PK, AUTOINCREMENT)                         │
│ session_id (TEXT, FK → sessions.id)                     │
│ role (TEXT)                                             │
│ content (TEXT)                                          │
│ created_at (DATETIME)                                   │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                   session_files                         │
├─────────────────────────────────────────────────────────┤
│ id (TEXT, PK)                                           │
│ session_id (TEXT, FK → sessions.id)                     │
│ file_path (TEXT)                                        │
│ file_type (TEXT)                                        │
│ added_at (DATETIME)                                     │
└─────────────────────────────────────────────────────────┘
```

## Vector Database (LanceDB)

```
┌─────────────────────────────────────────────────────────┐
│                  LanceDB Vector Store                   │
│                 (knowledge_base)                        │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                     knowledge_base                      │
├─────────────────────────────────────────────────────────┤
│ id (UUID, PK)                                           │
│ content (TEXT)                                          │
│ vector (FLOAT32[384]) - AllMiniLML6V2 embeddings        │
└─────────────────────────────────────────────────────────┘
                        ▲
                        │
┌─────────────────────────────────────────────────────────┐
│              Document Ingestion Flow                    │
├─────────────────────────────────────────────────────────┤
│ 1. Text Chunking (by \n, 20+ chars)                     │
│ 2. FastEmbed Generation (384-dim vectors)               │
│ 3. Arrow RecordBatch Creation                           │
│ 4. LanceDB Table Insertion                              │
└─────────────────────────────────────────────────────────┘
```

## Actor Message Types

```
┌─────────────────────────────────────────────────────────┐
│                 Supervisor Messages                     │
├─────────────────────────────────────────────────────────┤
│ ProcessUserMessage {                                    │
│   session_id: String,                                   │
│   content: String,                                      │
│   window: Option<Window>,                               │
│   responder: oneshot::Sender<Result<String, Error>>    │
│ }                                                      │
│ IngestContent {                                         │
│   content: String,                                       │
│   metadata: Option<String>,                             │
│   responder: oneshot::Sender<Result<String, Error>>    │
│ }                                                      │
│ Shutdown                                                │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                   RAG Messages                          │
├─────────────────────────────────────────────────────────┤
│ Ingest {                                                │
│   content: String,                                      │
│   metadata: Option<String>,                             │
│   responder: oneshot::Sender<Result<String, Error>>    │
│ }                                                      │
│ Search {                                                │
│   query: String,                                        │
│   session_id: Option<String>,                           │
│   limit: usize,                                         │
│   responder: oneshot::Sender<Result<Vec<String>, Error>>│
│ }                                                      │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                   LLM Messages                          │
├─────────────────────────────────────────────────────────┤
│ GenerateWithParams {                                    │
│   prompt: String,                                       │
│   system_prompt: Option<String>,                        │
│   temperature: Option<f32>,                             │
│   responder: oneshot::Sender<Result<String, Error>>    │
│ }                                                      │
│ StreamGenerateWithParams {                              │
│   prompt: String,                                       │
│   system_prompt: Option<String>,                         │
│   temperature: Option<f32>,                             │
│   chunk_sender: mpsc::Sender<Result<String, Error>>,   │
│   responder: oneshot::Sender<Result<(), Error>>        │
│ }                                                      │
└─────────────────────────────────────────────────────────┘
```

## File System Structure

```
┌─────────────────────────────────────────────────────────┐
│                 Application Root                        │
│              (PortablePathManager)                      │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                     data/                               │
├─────────────────────────────────────────────────────────┤
│ ├── db/                                                 │
│ │   └── whytchat.sqlite                                 │
│ ├── models/                                             │
│ │   └── llama-model.gguf                                │
│ ├── vectors/                                            │
│ │   └── lancedb_store/                                  │
│ └── files/                                              │
│     └── session_{uuid}/                                 │
│         └── uploaded_file.txt                           │
└─────────────────────────────────────────────────────────┘
```

## Internationalization (i18n)

```
┌─────────────────────────────────────────────────────────┐
│                 i18next Setup                           │
├─────────────────────────────────────────────────────────┤
│ Language Detection: Browser Language                    │
│ Fallback: English                                       │
│ Supported: English, French                              │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 Translation Files                       │
├─────────────────────────────────────────────────────────┤
│ src/locales/en/common.json                              │
│ src/locales/fr/common.json                              │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 Usage in Components                     │
├─────────────────────────────────────────────────────────┤
│ import { useTranslation } from 'react-i18next';         │
│ const { t } = useTranslation();                         │
│ <p>{t('chat.placeholder')}</p>                           │
└─────────────────────────────────────────────────────────┘
```

## State Management (Zustand)

```
┌─────────────────────────────────────────────────────────┐
│                 App Store                               │
├─────────────────────────────────────────────────────────┤
│ UI State:                                               │
│ - isSidebarOpen                                         │
│ - currentSessionId                                       │
│ - sessions[]                                             │
│                                                         │
│ Thinking State:                                         │
│ - isThinking                                             │
│ - thinkingSteps[]                                        │
│                                                         │
│ Onboarding:                                             │
│ - isConfigured                                           │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 Actions                                 │
├─────────────────────────────────────────────────────────┤
│ loadSessions()                                          │
│ createSession()                                         │
│ updateSession()                                         │
│ setThinking()                                           │
│ addThinkingStep()                                       │
│ clearThinkingSteps()                                    │
└─────────────────────────────────────────────────────────┘
```

## Build & Development

````
┌─────────────────────────────────────────────────────────┐
│                 Development Setup                       │
├─────────────────────────────────────────────────────────┤
│ npm run dev                                             │
│ ├── npm run dev --prefix apps/desktop-ui                │
│ └── cargo tauri dev                                     │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 Production Build                        │
├─────────────────────────────────────────────────────────┤
│ npm run build                                           │
│ ├── npm run build --prefix apps/desktop-ui              │
│ └── cargo tauri build                                   │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 Toolchain                               │
├─────────────────────────────────────────────────────────┤
│ Frontend: Vite + React + Tailwind                       │
│ Backend: Rust + Tauri + Tokio                           │
│ Quality: ESLint + Prettier + Husky                      │
└─────────────────────────────────────────────────────────┘
```</content>
<parameter name="filePath">/workspaces/WhytChat/WHYTCHAT_ARCHITECTURE.md
````
